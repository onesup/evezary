var imageslider_current = 0;
var imageslider_last_index;
var imageslider_sliding = false;
$(document).ready(function() {  
  
  $.ajaxSetup({ cache: true });
  $.getScript('//connect.facebook.net/ko_KR/all.js', function(){
    FB.init({
      appId      : '<%= FACEBOOK_CONFIG[:app_id] %>', // App ID from the app dashboard
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      xfbml      : true  // parse XFBML
    });       
  
  $('#event_tracking').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', '상단_이벤트_참여하기_링크_1504');
    $.ajax({
      url:"http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1504",
      type: "GET",
      success: function(response) {
        window.location.href = $('#event_tracking').attr("href");
      }
    });
  });

  $('#behind_tracking').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', '상단_비하인드_스토리_링크_1505');
    $.ajax({
      url:"http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1505",
      type: "GET",
      success: function(response) {
        window.location.href = $('#behind_tracking').attr("href");
      }
    });
  });
  
  $('#track6').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', '초록색 디자인 투표하기 버튼 1506');
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1506")
      .done(function(data){
        // window.location.href = $('track6').attr("href");
      });
  });
  
  $('#track7').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', '까만색 이벤트 소문내기 버튼 1507');
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1507")
      .done(function(data){
        // window.location.href = $('track6').attr("href");
      });
  });
  $('#track13').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', '소문내기 팝업 바로 완료하기 버튼 1513');
    $.ajax({
      url:"http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1513",
      type: "GET",
      success: function(response) {
        $.modal.close();
      },error:function(XMLHttpRequest,status,error){
        $.modal.close();
      }
    });
  });
  
  $('#track13_again').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', '소문내기 팝업 이미 참여한 경우 완료하기 버튼 1513');
    $.ajax({
      url:"http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1513",
      type: "GET",
      success: function(response) {
        $.modal.close();
      },error:function(XMLHttpRequest,status,error){
        $.modal.close();
      }
    });
  });  
  
  
  $('#popup_rumor_blog_url').on($.modal.BEFORE_OPEN, function(event, modal) {
    ga('send', 'event', 'button', 'popup', '블로그 소문내기 url 표시 팝업 1513');
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1513");
  });
  
  $('#popup_rumor_blog').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', 'sns 소문내기 팝업의 블로그 소문내기 버튼 1515');
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1515");
    var text = "죄송합니다. \n이벤트가 종료되었습니다. \n(1월 27일 종료)"
    alert(text);
    
    var input_name = $("#popup_input_name").val().length
    var viral_input_name = $("#popup_viral_input_name").val().length
    if(input_name === 0 && viral_input_name === 0){
      // $("#popup_viral_input").modal();
    }else{
      // $("#popup_rumor_blog_url").modal();
    }
  });
  
  $('#rumor_blog').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', '메인화면의 블로그 소문내기 버튼 1515');
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1515");
    var text = "죄송합니다. \n이벤트가 종료되었습니다. \n(1월 27일 종료)"
    alert(text);
    var input_name = $("#popup_input_name").val().length
    var viral_input_name = $("#popup_viral_input_name").val().length
    if(input_name === 0 && viral_input_name === 0){
      // $("#popup_viral_input").modal();
    }else{
      // $("#popup_rumor_blog_url").modal();
    }
  });
  
  $('#fb_share').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', '메인화면의 페이스북 소문내기 버튼 1514');
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1514");
    var text = "죄송합니다. \n이벤트가 종료되었습니다. \n(1월 27일 종료)"
    alert(text);
    
    var input_name = $("#popup_input_name").val().length
    var viral_input_name = $("#popup_viral_input_name").val().length
    if(input_name === 0 && viral_input_name === 0){
      // $("#popup_viral_input").modal();
    }else{
      // share();
    }
  });
  $('#popup_fb_share').bind('click', function(e) {
    e.preventDefault();
    ga('send', 'event', 'button', 'click', 'sns 소문내기 팝업의 페이스북 소문내기 버튼 1514');
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1514");
    
    var text = "죄송합니다. \n이벤트가 종료되었습니다. \n(1월 27일 종료)"
    alert(text);
    
    var input_name = $("#popup_input_name").val().length
    var viral_input_name = $("#popup_viral_input_name").val().length
    if(input_name === 0 && viral_input_name === 0){
      // $("#popup_viral_input").modal();
    }else{
      // share();
    }
  });
  
});
  
	$(".menu a:eq(1) img").hover(function() {
		$(this).attr("src", "<%= asset_path('top_link_behind_bold.png') %>");
	}, function() {
		$(this).attr("src", "<%= asset_path('top_link_behind.png') %>");
	});

	$("#content .main_content .images").click(function() {
    // $("#content .main_content .sub").hide();
	});

	$("#content .main_content .sub .box").click(function() {
    // $("#content .main_content .sub").hide();
	});

	$("a[href^='#event_content']").click(function(event){		
		event.preventDefault();
		$('html,body').animate({scrollTop:$('[name="'+this.hash.substring(1)+'"]').offset().top}, 300);
	}); // A href Smooth Scroll
  
  $('#popup_input').submit(function(e){    
    e.preventDefault();
    ga('send', 'event', 'submit', 'click', '투표 submit');
  }).validate({
    rules: {
      "user[name]": { required: true },
      "user[email]": { 
        required: true
      },
      "agree": { required: true},
      "phone3": { required: true }
    },
    messages: {
      "user[name]": {
        required: "*",
      },
      "user[email]": {
        required: "*"
      },
      "agree": {
        required: "*",
      },
      "phone3": {
        required: "*"
      }
    },
    submitHandler: function(form) {
      var phone1 = $("#popup_input_phone1").val();
      var phone2 = $("#popup_input_phone2").val();
      var phone3 = $("#popup_input_phone3").val();
      var phone = phone1+"-"+phone2+"-"+phone3;
      $.ajax({
        'url':'/is_surveyed.json?id='+phone,
        'dataType':'json',
        'data':{},
        'success':function(data){
          if(data.result == false){
            var text = "감사합니다. \n당첨자는 2월 7일에 발표됩니다."
            alert(text);
            $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1512");
            var name = $("#popup_input_name").val() + " 님의 공유 URL";
            var code = "http://event2.evezary.co.kr/" + $('meta[name="blog-code"]').attr('content');
            $("#blog_code_user_name").text(name);
            $("#blog_code_url").text(code);
            $("#popup_rumor").modal();
          }else if(data.result == "timeover"){
            var text = "죄송합니다. \n이벤트가 종료되었습니다. \n(1월 27일 종료)"
            alert(text);
          }else{
            $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1512");
            var name = data.name + " 님의 공유 URL";
            $("#blog_code_user_name").text(name);
            var blog_code = "http://event2.evezary.co.kr/" + data.blog_code;
            $("#blog_code_url").text(blog_code);
            $("#popup_rumor_again").modal();
          }
        },
        'false':function(data){

        }
      });
      $.rails.handleRemote($(form));
    },
    
  });
  


  $('#popup_viral_input').submit(function(e){    
    e.preventDefault();
    ga('send', 'event', 'submit', 'click', '소문내기 submit');
  }).validate({
    rules: {
      "user[name]": { required: true },
      "user[email]": { 
        required: true
      },
      "agree": { required: true},
      "phone3": { required: true }
    },
    messages: {
      "user[name]": {
        required: "*",
      },
      "user[email]": {
        required: "*"
      },
      "agree": {
        required: "*",
      },
      "phone3": {
        required: "*"
      }
    },
    submitHandler: function(form) {
    	var phone1 = $("#popup_viral_input_phone1").val();
    	var phone2 = $("#popup_viral_input_phone2").val();
    	var phone3 = $("#popup_viral_input_phone3").val();
      var phone = phone1+"-"+phone2+"-"+phone3;
    	$.ajax({
    		'url':'/is_surveyed.json?id='+phone,
    		'dataType':'json',
    		'data':{},
    		'success':function(data){
          if(data.result == false){
            var text = "감사합니다. \n당첨자는 2월 7일에 발표됩니다."
            alert(text);
            $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1512");
            var name = $("#popup_viral_input_name").val() + " 님의 공유 URL";
            var code = "http://event2.evezary.co.kr/" + $('meta[name="blog-code"]').attr('content');
            $("#blog_code_user_name").text(name);
            $("#blog_code_url").text(code);
            $("#popup_rumor").modal();
          }else if(data.result == "timeover"){
            var text = "죄송합니다. \n이벤트가 종료되었습니다. \n(1월 27일 종료)"
            alert(text);
          }else{
            $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=1512");
            var name = $("#popup_viral_input_name").val() + " 님의 공유 URL";
            var code = "http://event2.evezary.co.kr/" + data.blog_code;
            $("#blog_code_user_name").text(name);
            $("#blog_code_url").text(code);
            $("#popup_rumor_again").modal();
          }
    		}
      });
      $.rails.handleRemote($(form));
  
    },
  });
  
	

	
$(window).resize(function() {
var width = 1920; 
// if(width < 1024) width = 1024;
var height = 664;

var width = $(window).width(); 
    // if(width < 1024) width = 1024;
var height = $(".imageslider").height() * (width / $(".imageslider").width());
// $(".imageslider").width(width);
  $(".imageslider").width($(window).width());
  // $(".imageslider").height(height);
  // $(".imageslider .images").width(width);
  // $(".imageslider .images").height(height);

  var total_width = 0;
  $(".imageslider .image").each(function(index, item) {
    $(this).css("left", total_width);
    total_width += 1920;
    // total_width += width;
  });

  $(".imageslider .image img").each(function() {
    // $(this).width(width);
    // $(this).height(height);
  });
  });
  $(window).resize();  
	
	$(".imageslider .imageslider_left").click(function() {
		imageslider_slideTo(imageslider_current - 1);
	});
	
	$(".imageslider .imageslider_right").click(function() {
		imageslider_slideTo(imageslider_current + 1);
	});
	
	imageslider_updateLayout();
	
	function imageslider_slideTo(index) {
		if(imageslider_sliding)
			return;
		
		imageslider_sliding = true;
		imageslider_current = index;
		
		imageslider_updateLayout();
		
		var left = imageslider_current * $(".imageslider .image").width();
		$(".imageslider .images").animate({
			scrollLeft: left
		}, 400, "swing", function() {
			imageslider_sliding = false;
		});
	}
	
	function imageslider_updateLayout() {
    imageslider_last_index = $(".imageslider .image").length - 1;
		if(imageslider_current == -1) {
			imageslider_current = 0;
			$(".imageslider .images").prepend(
				$(".imageslider .image").last().clone()
			);
			$(".imageslider .image").each(function(index, item) {
				$(this).css("left", index * $(this).width());
			});
			$(".imageslider .image").last().remove();
			$(".imageslider .images").animate({
				scrollLeft: $(".imageslider .image").width()
			}, 0);
		}
		else if(imageslider_current >= imageslider_last_index + 1) {
			imageslider_current = imageslider_last_index;
			$(".imageslider .images").append(
				$(".imageslider .image").eq(0).clone()
			);
			$(".imageslider .image").eq(0).remove();
			$(".imageslider .image").each(function(index, item) {
				$(this).css("left", index * $(this).width());
			});
			$(".imageslider .images").animate({
				scrollLeft: $(".imageslider .image").width() * (imageslider_last_index - 1)
			}, 0);
		}
	}
	
});
	
var selected_item;

function selectItem(index, target) {
	var detail_images = [
    [
      "<%= asset_url('popup_detail/image_0_0.png') %>",
      "<%= asset_url('popup_detail/image_0_1.png') %>",
      "<%= asset_url('popup_detail/image_0_2.png') %>",
    ],[
      "<%= asset_path('popup_detail/image_1_0.png') %>",
      "<%= asset_path('popup_detail/image_1_1.png') %>",
      "<%= asset_path('popup_detail/image_1_2.png') %>",
    ],[
      "<%= asset_path('popup_detail/image_2_0.png') %>",
      "<%= asset_path('popup_detail/image_2_1.png') %>",
      "<%= asset_path('popup_detail/image_2_2.png') %>",
    ],[
      "<%= asset_path('popup_detail/image_3_0.png') %>",
      "<%= asset_path('popup_detail/image_3_1.png') %>",
      "<%= asset_path('popup_detail/image_3_2.png') %>",
    ]
  ]
  var detail_texts = [
    "<%= asset_url('popup_detail/image_0_txt.png') %>",
    "<%= asset_url('popup_detail/image_1_txt.png') %>",
    "<%= asset_url('popup_detail/image_2_txt.png') %>",
    "<%= asset_url('popup_detail/image_3_txt.png') %>",
  ]
	var vote_images = [
    "<%= asset_path('popup_vote/image_minimal_skin.png') %>",
    "<%= asset_path('popup_vote/image_1.png') %>",
    "<%= asset_path('popup_vote/image_2.png') %>",
    "<%= asset_path('popup_vote/image_3.png') %>"
  ]
  
	selected_item = index;
	$("#popup_detail .sub").css("background-image", "url('"+detail_images[index][0]+"')");
  $("#popup_detail .detail_text").css("background-image", "url('"+detail_texts[index]+"')");
	$("#popup_detail .popup_detail_navigator img").each(function(__index, item) {
		if(__index == 0) {
			$(this).attr("src", "<%= asset_path 'popup_detail/slide_current.png' %>");
		}else{
			$(this).attr("src", "<%= asset_path 'popup_detail/slide_other.png' %>");
		}
		$(this).click(function() {
			$("#popup_detail .popup_detail_navigator img").each(function() {
				$(this).attr("src", "<%= asset_path 'popup_detail/slide_other.png' %>");
			});
			$(this).attr("src", "<%= asset_path 'popup_detail/slide_current.png' %>");
      $("#popup_detail .sub").css("background-image", "url('"+detail_images[index][__index]+"')");
		});
		$(this).addClass("rollover");
	});
  $("#popup_vote .top").css("background-image", "url('" + vote_images[index] + "')");
  $("#popup_input_survey").val(index);
  var text = "죄송합니다. \n이벤트가 종료되었습니다. \n(1월 27일 종료)"
  alert(text);
  var track_codes=[1508,1509,1510,1511];
  var detail_track_codes=[1532,1533,1534,1535];
  if(target == "detail"){
    ga('send', 'event', 'click', 'click', '제품 돋보기 클릭 ' + detail_track_codes[index]);
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=" + detail_track_codes[index]);
  }else if(target == "vote"){
    ga('send', 'event', 'click', 'click', '제품 투표하기 클릭' + track_codes[index]);
    $.get("http://i85.icast-ad.com/track?ccd=1185&mcd=01040601&pcd=" + track_codes[index]);
  }
  
}

function fixPNGs(){
  if(jQuery.browser.msie && jQuery.browser.version < 9){ 
    var i;
    for(i in document.images){
      if(document.images[i].src){
        var imgSrc = document.images[i].src;
        if(imgSrc.substr(imgSrc.length-4) === '.png' || imgSrc.substr(imgSrc.length-4) === '.PNG'){
        document.images[i].style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true',sizingMethod='crop',src='" + imgSrc + "')";
        }
      }
    }   
  }
}